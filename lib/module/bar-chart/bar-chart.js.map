{"version":3,"sources":["bar-chart.js"],"names":["BarChart","width","height","event","nativeEvent","layout","setState","domain","props","horizontal","contentInset","left","right","spacingInner","spacingOuter","clamp","state","scale","scaleLinear","range","scaleBand","paddingInner","paddingOuter","top","bottom","x","y","data","yAccessor","values","map","item","bar","index","path","shape","area","value","_index","bandwidth","x0","x1","defined","y0","y1","gridMin","gridMax","obj","extent","array","yMin","yMax","_","animate","animationDuration","style","numberOfTicks","svg","children","length","calcExtent","indexes","calcIndexes","ticks","xDomain","yDomain","calcXScale","calcYScale","areas","calcAreas","filter","undefined","extraProps","flex","_onLayout","React","Children","child","belowChart","cloneElement","barSvg","PureComponent","propTypes","PropTypes","arrayOf","oneOfType","number","object","isRequired","any","bool","defaultProps"],"mappings":"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","sourcesContent":["import * as array from 'd3-array';\nimport * as scale from 'd3-scale';\nimport * as shape from 'd3-shape';\nimport PropTypes from 'prop-types';\nimport React, {PureComponent} from 'react';\nimport {View} from 'react-native';\nimport Svg from 'react-native-svg';\nimport Path from '../animated-path';\n\nclass BarChart extends PureComponent {\n  state = {\n    width: 0,\n    height: 0,\n  };\n\n  _onLayout(event) {\n    const {\n      nativeEvent: {\n        layout: {height, width},\n      },\n    } = event;\n    this.setState({height, width});\n  }\n\n  calcXScale(domain) {\n    const {\n      horizontal,\n      contentInset: {left = 0, right = 0},\n      spacingInner,\n      spacingOuter,\n      clamp,\n    } = this.props;\n\n    const {width} = this.state;\n\n    if (horizontal) {\n      return scale\n        .scaleLinear()\n        .domain(domain)\n        .range([left, width - right])\n        .clamp(clamp);\n    }\n\n    return scale\n      .scaleBand()\n      .domain(domain)\n      .range([left, width - right])\n      .paddingInner([spacingInner])\n      .paddingOuter([spacingOuter]);\n  }\n\n  calcYScale(domain) {\n    const {\n      horizontal,\n      contentInset: {top = 0, bottom = 0},\n      spacingInner,\n      spacingOuter,\n      clamp,\n    } = this.props;\n\n    const {height} = this.state;\n\n    if (horizontal) {\n      return scale\n        .scaleBand()\n        .domain(domain)\n        .range([top, height - bottom])\n        .paddingInner([spacingInner])\n        .paddingOuter([spacingOuter]);\n    }\n\n    return scale\n      .scaleLinear()\n      .domain(domain)\n      .range([height - bottom, top])\n      .clamp(clamp);\n  }\n\n  calcAreas(x, y) {\n    const {horizontal, data, yAccessor} = this.props;\n\n    const values = data.map((item) => yAccessor({item}));\n\n    if (horizontal) {\n      return data.map((bar, index) => ({\n        bar,\n        path: shape\n          .area()\n          .y((value, _index) =>\n            _index === 0 ? y(index) : y(index) + y.bandwidth(),\n          )\n          .x0(x(0))\n          .x1((value) => x(value))\n          .defined((value) => typeof value === 'number')([\n          values[index],\n          values[index],\n        ]),\n      }));\n    }\n\n    return data.map((bar, index) => ({\n      bar,\n      path: shape\n        .area()\n        .y0(y(0))\n        .y1((value) => y(value))\n        .x((value, _index) =>\n          _index === 0 ? x(index) : x(index) + x.bandwidth(),\n        )\n        .defined((value) => typeof value === 'number')([\n        values[index],\n        values[index],\n      ]),\n    }));\n  }\n\n  calcExtent() {\n    const {data, gridMin, gridMax, yAccessor} = this.props;\n    const values = data.map((obj) => yAccessor({item: obj}));\n\n    const extent = array.extent([...values, gridMax, gridMin]);\n\n    const {yMin = extent[0], yMax = extent[1]} = this.props;\n\n    return [yMin, yMax];\n  }\n\n  calcIndexes() {\n    const {data} = this.props;\n    return data.map((_, index) => index);\n  }\n\n  render() {\n    const {\n      data,\n      animate,\n      animationDuration,\n      style,\n      numberOfTicks,\n      svg,\n      horizontal,\n      children,\n    } = this.props;\n\n    const {height, width} = this.state;\n\n    if (data.length === 0) {\n      return <View style={style} />;\n    }\n\n    const extent = this.calcExtent();\n    const indexes = this.calcIndexes();\n    const ticks = array.ticks(extent[0], extent[1], numberOfTicks);\n\n    const xDomain = horizontal ? extent : indexes;\n    const yDomain = horizontal ? indexes : extent;\n\n    const x = this.calcXScale(xDomain);\n    const y = this.calcYScale(yDomain);\n\n    const bandwidth = horizontal ? y.bandwidth() : x.bandwidth();\n\n    const areas = this.calcAreas(x, y).filter(\n      (area) =>\n        area.bar !== null && area.bar !== undefined && area.path !== null,\n    );\n\n    const extraProps = {\n      x,\n      y,\n      width,\n      height,\n      bandwidth,\n      ticks,\n      data,\n    };\n\n    return (\n      <View style={style}>\n        <View style={{flex: 1}} onLayout={(event) => this._onLayout(event)}>\n          {height > 0 && width > 0 && (\n            <Svg style={{height, width}}>\n              {React.Children.map(children, (child) => {\n                if (child && child.props.belowChart) {\n                  return React.cloneElement(child, extraProps);\n                }\n              })}\n              {areas.map((area, index) => {\n                const {\n                  bar: {svg: barSvg = {}},\n                  path,\n                } = area;\n\n                return (\n                  <Path\n                    key={index}\n                    {...svg}\n                    {...barSvg}\n                    d={path}\n                    animate={animate}\n                    animationDuration={animationDuration}\n                  />\n                );\n              })}\n              {React.Children.map(children, (child) => {\n                if (child && !child.props.belowChart) {\n                  return React.cloneElement(child, extraProps);\n                }\n              })}\n            </Svg>\n          )}\n        </View>\n      </View>\n    );\n  }\n}\n\nBarChart.propTypes = {\n  data: PropTypes.arrayOf(\n    PropTypes.oneOfType([PropTypes.number, PropTypes.object]),\n  ).isRequired,\n  style: PropTypes.any,\n  spacingInner: PropTypes.number,\n  spacingOuter: PropTypes.number,\n  animate: PropTypes.bool,\n  animationDuration: PropTypes.number,\n  contentInset: PropTypes.shape({\n    top: PropTypes.number,\n    left: PropTypes.number,\n    right: PropTypes.number,\n    bottom: PropTypes.number,\n  }),\n  numberOfTicks: PropTypes.number,\n  gridMin: PropTypes.number,\n  gridMax: PropTypes.number,\n  svg: PropTypes.object,\n\n  yMin: PropTypes.any,\n  yMax: PropTypes.any,\n  clamp: PropTypes.bool,\n};\n\nBarChart.defaultProps = {\n  spacingInner: 0.05,\n  spacingOuter: 0.05,\n  contentInset: {},\n  numberOfTicks: 10,\n  svg: {},\n  yAccessor: ({item}) => item,\n};\n\nexport default BarChart;\n"]}